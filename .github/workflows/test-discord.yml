name: Dota 2 Discord Test

on:
  workflow_dispatch:

jobs:
  test-discord:
    runs-on: ubuntu-latest
    steps:
      - name: Send test embed to Discord (safe multiline)
        env:
          DISCORD_WEBHOOK: ${{ secrets.DISCORD_WEBHOOK }}
        run: |
          set -euo pipefail

          if [ -z "${DISCORD_WEBHOOK:-}" ]; then
            echo "‚ö†Ô∏è DISCORD_WEBHOOK not set. Aborting."
            exit 1
          fi

          # --- –±–µ–∑–æ–ø–∞—Å–Ω–∞—è –∑–∞–ø–∏—Å—å –º–Ω–æ–≥–æ—Å—Ç—Ä–æ—á–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞ ---
          printf '%s\n' "**–¢–∏–ø –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:** Dota 2 Test Mode" "" \
            "**–ß—Ç–æ –Ω–æ–≤–æ–≥–æ:**" \
            "[v] test 12345 => 12346" \
            "[h] testhash123 => testhash456" \
            "[s] test CN hero => hero2" "" \
            "üîó [–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∫–æ–º–º–∏—Ç](https://github.com/AINewsAccount/DOTA2_WEB/commit/testhash)" > /tmp/desc.txt

          # --- —Å–æ–∑–¥–∞–µ–º embed —á–µ—Ä–µ–∑ jq —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –ø–µ—Ä–µ–Ω–æ—Å–∞–º–∏ ---
          json=$(jq -n --rawfile desc /tmp/desc.txt \
            --arg title "üß™ Dota 2 Test Notification" \
            --argjson color 16776960 \
            '{embeds: [{title: $title, description: $desc, color: $color}]}')

          echo "–û—Ç–ø—Ä–∞–≤–ª—è—é —Ç–µ—Å—Ç–æ–≤–æ–µ embed-—Å–æ–æ–±—â–µ–Ω–∏–µ..."
          curl -sS -H "Content-Type: application/json" -X POST -d "$json" "$DISCORD_WEBHOOK" \
            && echo "‚úÖ –£—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ Discord" \
            || echo "‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ"
